# スプレッドシート更新機能 仕様書

## 1. 概要
投稿成功後、スプレッドシートの該当行の投稿回数をカウントアップし、最終投稿日時を更新する機能。

## 2. ファイル構成と責務

### 2.1 `bots/auto_post_bot/spreadsheet_manager.py`
スプレッドシートの操作を担当するクラスを提供する。

#### クラス: `SpreadsheetManager`
- 責務：
  - Google Sheetsへの接続管理
  - スプレッドシートの読み書き操作
  - 列の検索と更新処理

- 主要メソッド：
  1. `__init__(config, logger=None)`
     - 設定の初期化とロガーの設定
     - Google Sheets APIクライアントの初期化を開始

  2. `_initialize_client()`
     - Google Sheets APIクライアントの初期化
     - 認証情報の設定
     - スプレッドシートへの接続確立

  3. `update_post_status(row_number, post_count=None, last_posted_at=None)`
     - 投稿成功後のステータス更新
     - 投稿回数のインクリメント
     - 最終投稿日時の更新
     - ステータスを「投稿済」に変更

  4. `_find_column_index(column_name)`
     - 列名から列番号（1-indexed）を取得
     - 存在しない列名の場合はNoneを返却

### 2.2 `bots/auto_post_bot/post_tweet.py`
投稿処理とスプレッドシート更新の連携を担当。

#### 関数: `main()`
- 責務：
  - 設定の読み込み
  - TwitterClientとSpreadsheetManagerの初期化
  - 投稿処理の実行
  - 投稿成功時のスプレッドシート更新

## 3. データ仕様

### 3.1 スプレッドシートの列構成
- `投稿回数`: 整数値
- `最終投稿日時`: ISO形式の日時文字列
- `ステータス`: 文字列（"投稿済"）

### 3.2 更新ルール
1. 投稿回数
   - 現在の値を取得
   - 数値でない場合は0として扱う
   - 1をインクリメント

2. 最終投稿日時
   - 投稿成功時の現在時刻（ISO形式）で更新

3. ステータス
   - "投稿済"に固定

## 4. エラー処理

### 4.1 初期化時のエラー処理
- 設定ファイルの不備
- 認証情報の不備
- スプレッドシートへの接続失敗

### 4.2 更新時のエラー処理
- 列が見つからない場合
- データ型の不一致
- API制限やネットワークエラー
- バッチ更新の失敗

## 5. ログ出力
- 初期化成功/失敗
- 更新処理の成功/失敗
- エラー発生時の詳細情報

## 6. 制約事項
- Google Sheets APIの制限に従う
- バッチ更新で複数セルを同時に更新
- 行番号は1-indexedで指定 