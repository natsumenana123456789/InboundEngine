name: ðŸŽ¥ Video Conversion

on:
  schedule:
    # 30åˆ†ã”ã¨ã«å®Ÿè¡Œï¼ˆå¤‰æ›å¯¾è±¡ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
    - cron: '*/30 * * * *'
  workflow_dispatch:
    # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
    inputs:
      force_run:
        description: 'å¼·åˆ¶å®Ÿè¡Œ'
        required: false
        default: 'false'

jobs:
  convert-videos:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ðŸ“¦ Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ffmpeg
        ffmpeg -version
    
    - name: ðŸ“š Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install gspread google-auth google-auth-oauthlib google-auth-httplib2
        pip install requests Pillow
        
    - name: ðŸ“‚ Create config directory
      run: |
        mkdir -p config
    
    - name: ðŸ” Create service account file
      run: |
        echo '${{ secrets.GOOGLE_SERVICE_ACCOUNT_JSON }}' > config/google_service_account.json
        ls -la config/
    
    - name: ðŸŽ¬ Run video conversion
      run: |
        python bots/video_converter/image_to_video.py
      env:
        SPREADSHEET_ID: '1lgCn5iAiFT9PSr3vA3Tp1SePe0g3B9Xe1ppsr8bn2FA'
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
    
    - name: ðŸ§¹ Cleanup
      run: |
        rm -f config/google_service_account.json
        echo "âœ… ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤å®Œäº†" 